#!/usr/bin/env node

var Server = require('../server.js');
var Telescope = require('../telescope.js');
var Config = require('../config.js');

var config = new Config().readConfiguration();

process.on('uncaughtException', function(err) {
    if(err.errno === 'EADDRINUSE')
         console.log("ERROR: An existing process is already listening on port", config.port);
    else
         throw err;
    process.exit(1);
});

var server = new Server(config.port);
var telescope = new Telescope(config.device);

server.on('data', function(buffer) {
    telescope.write(buffer);
});

telescope.on('data', function(buffer) {
    server.write(buffer);
});

telescope.start();
server.start();
